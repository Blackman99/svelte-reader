import{S as M,i as j,s as D,e as v,c as I,j as $,f as q,a as y,b as P,l as m,m as z,p as R,t as A,g as B,d as w,h as F,q as G,r as J}from"./index-70cf4e1e.js";import{S as K,e as C}from"./SvelteReader-46b733b3.js";function E(l,e,r){const s=l.slice();return s[10]=e[r],s[12]=r,s}function H(l){let e,r=l[10].excerpt.trim().replace(l[1],`<span style="color: orange">${l[1]}</span>`)+"",s,f;function c(...a){return l[8](l[10],...a)}return{c(){e=v("div"),y(e,"class","item svelte-11d5m3y")},m(a,d){P(a,e,d),e.innerHTML=r,s||(f=R(e,"click",c),s=!0)},p(a,d){l=a,d&6&&r!==(r=l[10].excerpt.trim().replace(l[1],`<span style="color: orange">${l[1]}</span>`)+"")&&(e.innerHTML=r)},d(a){a&&w(e),s=!1,f()}}}function L(l){let e;return{c(){e=v("div"),e.textContent="Empty"},m(r,s){P(r,e,s)},d(r){r&&w(e)}}}function N(l){let e,r,s,f,c,a,d,p,k,g,b,S;s=new K({props:{url:"/svelte-reader/files/啼笑因缘.epub",getRendition:l[5]}});let o=C(l[2]),n=[];for(let t=0;t<o.length;t+=1)n[t]=H(E(l,o,t));let i=!l[2].length&&L();return{c(){e=v("div"),r=v("div"),I(s.$$.fragment),f=$(),c=v("div"),a=v("input"),d=$(),p=v("div");for(let t=0;t<n.length;t+=1)n[t].c();k=$(),i&&i.c(),q(r,"height","100vh"),a.value=l[1],y(a,"type","text"),y(a,"placeholder","search"),y(p,"class","searchResults svelte-11d5m3y"),y(c,"class","search svelte-11d5m3y"),q(e,"position","relative")},m(t,h){P(t,e,h),m(e,r),z(s,r,null),m(e,f),m(e,c),m(c,a),m(c,d),m(c,p);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(p,null);m(p,k),i&&i.m(p,null),g=!0,b||(S=[R(a,"input",l[6]),R(a,"keyup",l[7])],b=!0)},p(t,[h]){const _={};if(h&1&&(_.getRendition=t[5]),s.$set(_),(!g||h&2&&a.value!==t[1])&&(a.value=t[1]),h&22){o=C(t[2]);let u;for(u=0;u<o.length;u+=1){const T=E(t,o,u);n[u]?n[u].p(T,h):(n[u]=H(T),n[u].c(),n[u].m(p,k))}for(;u<n.length;u+=1)n[u].d(1);n.length=o.length}t[2].length?i&&(i.d(1),i=null):i||(i=L(),i.c(),i.m(p,null))},i(t){g||(A(s.$$.fragment,t),g=!0)},o(t){B(s.$$.fragment,t),g=!1},d(t){t&&w(e),F(s),G(n,t),i&&i.d(),b=!1,J(S)}}}function O(l,e,r){let s=null,f="只在捻花一笑中",c=[];const a=async()=>{if(!f)return r(2,c=[]);const o=await d(f);r(2,c=o.slice(0,5))},d=o=>{const{book:n}=s;return Promise.all(n.spine.spineItems.map(i=>i.load(n.load.bind(n)).then(t=>{const h=i.find(o);return i.unload(),Promise.resolve(h)}))).then(i=>Promise.resolve([].concat.apply([],i)))},p=(o,n)=>{s.display(o),n.stopPropagation(),n.preventDefault()};return[s,f,c,a,p,o=>r(0,s=o),o=>r(1,f=o.target.value),o=>o.key==="Enter"&&a(),(o,n)=>p(o.cfi,n)]}class V extends M{constructor(e){super(),j(this,e,O,N,D,{})}}export{V as default};
